<html>

<head>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
        crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"
        crossorigin="anonymous"></script>

    <script>
        document.write('<script src="http://' + (location.host || 'localhost').split(':')[0] + ':35729/livereload.js?snipver=2"></' + 'script>')
    </script>
    <script src="https://code.createjs.com/1.0.0/createjs.min.js"></script>
    <script src="graphics.js"></script>
    <script src="rf.js"></script>
    <script>
        function downloadAsPng() {
            document.getElementById("downloader").download = "image.png";
            document.getElementById("downloader").href = document.getElementById("rf-canvas").toDataURL("image/png").replace(/^data:image\/[^;]/, 'data:application/octet-stream');
        }
        function addLayer() {
            let n_layers = parseInt(localStorage.getItem('n_layers'));
            if (isNaN(n_layers)) {
                n_layers = 0;
            }
            n_layers += 1;

            let kernel = document.getElementById('textKernelSize').value;
            let stride = document.getElementById('textStride').value;
            let padding = document.getElementById('textPadding').value;
            let dilation = document.getElementById('textDilation').value;
            let layer_info = JSON.stringify({ "kernel": kernel, "stride": stride, 'padding': padding, 'dilation': dilation });
            let layer_name = 'layer' + n_layers;
            console.log('Add Layer:', layer_name, layer_info);

            localStorage.setItem(layer_name, layer_info);
            localStorage.setItem('n_layers', n_layers);

            init();
        }

        function resetLayer(cmd) {
            if (cmd == 'ALL') {
                localStorage.clear();
            } else if (cmd == 'LAST') {
                let n_layers = parseInt(localStorage.getItem('n_layers'));
                if (!isNaN(n_layers) && n_layers > 0) {
                    localStorage.removeItem('layer' + n_layers)
                    n_layers -= 1;
                    localStorage.setItem('n_layers', n_layers);
                }
            } else {
                console.warn('Unknown resetLayer command:', cmd)
            }

        }
    </script>
</head>

<body onload="init();">
    <header>
        <div class="navbar navbar-dark bg-dark box-shadow">
            <div class="container d-flex justify-content-between">
                <a href="#" class="navbar-brand d-flex align-items-center">
                    <strong>Visualizing Receptive Field</strong>
                </a>
                <li><a href="https://github.com/jojonki/Receptive-Field/" class="text-white">Go back to GitHub</a>
            </div>
        </div>
    </header>
    <div id="layers">

    </div>

    <div class="container">
        <hr>
        <div class="row">
            <div class="col-sm">
                <!-- INPUT SIZE -->
                <label class="form-label">INPUT SIZE</label>
                <input class="form-control" id="textInputSize" value=50 onChange="init();">
            </div>
        </div>
        <div class="row">
            <div class="col-sm">
                <label class="form-label">KERNEL</label>
                <input class="form-control" id="textKernelSize" value=3>
            </div>
            <div class="col-sm">
                <label class="form-label">STRIDE</label>
                <input class="form-control" id="textStride" value=2>
            </div>
            <div class="col-sm">
                <label class="form-label">PADDING</label>
                <input class="form-control" id="textPadding" value=0>
            </div>
            <div class="col-sm">
                <label class="form-label">DILATION</label>
                <input class="form-control" id="textDilation" value=1>
            </div>
        </div>
        <div class="row" style="margin-top:0.5em">
            <div class="col-sm">
                <button type="submit" class="btn btn-primary" onClick="addLayer();">Add Layer</button>
                <button type="submit" class="btn btn-danger" onClick="resetLayer('ALL'); init();">Reset Network</button>
                <button type="submit" class="btn btn-warning" onClick="resetLayer('LAST'); init();">Remove Layer
                </button>
                <a href="#" id="downloader" class="btn btn-info" onclick="downloadAsPng()" download="image.png">Download
                    as PNG</a>
            </div>


            <canvas id="rf-canvas" width="1280" height="1080"></canvas>
        </div>
</body>

</html>